INFO:     Will watch for changes in these directories: ['E:\\Downloads\\Startagain\\backend']
INFO:     Uvicorn running on http://127.0.0.1:8002 (Press CTRL+C to quit)
INFO:     Started reloader process [45392] using WatchFiles
WARNING:  WatchFiles detected changes in 'test_scoring_fix.py'. Reloading...
--- Logging error ---
Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 76, in serve
    logger.info(message, process_id, extra={"color_message": color_message})
Message: 'Started server process [%d]'
Arguments: (30688,)
--- Logging error ---
Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 78, in serve
    await self.startup(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 89, in startup
    await self.lifespan.startup()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\lifespan\on.py", line 48, in startup
    self.logger.info("Waiting for application startup.")
Message: 'Waiting for application startup.'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 78, in serve
    await self.startup(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 89, in startup
    await self.lifespan.startup()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\lifespan\on.py", line 62, in startup
    self.logger.info("Application startup complete.")
Message: 'Application startup complete.'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\chat.py", line 154, in route_intent
    state = _load_state(storage, session_id)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\chat.py", line 43, in _load_state
    return SessionState.load(storage, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 54, in load
    turn_index=self.turn_index,
    ^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 32, in save
    def save(self, store: Storage) -> None:
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 181, in __call__
    await response(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\responses.py", line 158, in __call__
    await send(
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 505, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:61829', 'POST', '/chat/route', '1.1', 500)
--- Logging error ---
Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\chat.py", line 154, in route_intent
    state = _load_state(storage, session_id)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\chat.py", line 43, in _load_state
    return SessionState.load(storage, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 54, in load
    turn_index=self.turn_index,
    ^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 32, in save
    def save(self, store: Storage) -> None:
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 440, in run_asgi
    self.logger.error(msg, exc_info=exc)
Message: 'Exception in ASGI application\n'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 53, in handle_conversation
    session = session_store.get_session()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\deps.py", line 247, in get_session
    self._session_state = SessionState.load(storage, self.session_id)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 54, in load
    turn_index=self.turn_index,
    ^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 32, in save
    def save(self, store: Storage) -> None:
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 81, in handle_conversation
    raise HTTPException(status_code=500, detail=f"Conversation error: {str(e)}")
fastapi.exceptions.HTTPException: 500: Conversation error: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\responses.py", line 158, in __call__
    await send(
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 161, in _send
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 505, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:61830', 'POST', '/chat/conversation', '1.1', 500)
--- Logging error ---
Traceback (most recent call last):
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 53, in handle_conversation
    session = session_store.get_session()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\deps.py", line 247, in get_session
    self._session_state = SessionState.load(storage, self.session_id)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 54, in load
    turn_index=self.turn_index,
    ^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 32, in save
    def save(self, store: Storage) -> None:
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 81, in handle_conversation
    raise HTTPException(status_code=500, detail=f"Conversation error: {str(e)}")
fastapi.exceptions.HTTPException: 500: Conversation error: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\responses.py", line 158, in __call__
    await send(
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 161, in _send
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 505, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:61831', 'POST', '/chat/conversation', '1.1', 500)
--- Logging error ---
Traceback (most recent call last):
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 53, in handle_conversation
    session = session_store.get_session()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\deps.py", line 247, in get_session
    self._session_state = SessionState.load(storage, self.session_id)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 54, in load
    turn_index=self.turn_index,
    ^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 32, in save
    def save(self, store: Storage) -> None:
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 81, in handle_conversation
    raise HTTPException(status_code=500, detail=f"Conversation error: {str(e)}")
fastapi.exceptions.HTTPException: 500: Conversation error: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\responses.py", line 158, in __call__
    await send(
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 161, in _send
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 505, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:61832', 'POST', '/chat/conversation', '1.1', 500)
--- Logging error ---
Traceback (most recent call last):
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 53, in handle_conversation
    session = session_store.get_session()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\deps.py", line 247, in get_session
    self._session_state = SessionState.load(storage, self.session_id)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 54, in load
    turn_index=self.turn_index,
    ^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 32, in save
    def save(self, store: Storage) -> None:
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 81, in handle_conversation
    raise HTTPException(status_code=500, detail=f"Conversation error: {str(e)}")
fastapi.exceptions.HTTPException: 500: Conversation error: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\responses.py", line 158, in __call__
    await send(
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 161, in _send
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 505, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:61833', 'POST', '/chat/conversation', '1.1', 500)
--- Logging error ---
Traceback (most recent call last):
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 53, in handle_conversation
    session = session_store.get_session()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\deps.py", line 247, in get_session
    self._session_state = SessionState.load(storage, self.session_id)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 54, in load
    turn_index=self.turn_index,
    ^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 32, in save
    def save(self, store: Storage) -> None:
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 81, in handle_conversation
    raise HTTPException(status_code=500, detail=f"Conversation error: {str(e)}")
fastapi.exceptions.HTTPException: 500: Conversation error: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\responses.py", line 158, in __call__
    await send(
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 161, in _send
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 505, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:61834', 'POST', '/chat/conversation', '1.1', 500)
--- Logging error ---
Traceback (most recent call last):
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 90, in get_pnm_profile
    session = session_store.get_session()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\deps.py", line 247, in get_session
    self._session_state = SessionState.load(storage, self.session_id)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 54, in load
    turn_index=self.turn_index,
    ^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 32, in save
    def save(self, store: Storage) -> None:
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 124, in get_pnm_profile
    raise HTTPException(status_code=500, detail=f"Profile error: {str(e)}")
fastapi.exceptions.HTTPException: 500: Profile error: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\responses.py", line 158, in __call__
    await send(
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 161, in _send
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 505, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:61835', 'GET', '/chat/pnm-profile', '1.1', 500)
--- Logging error ---
Traceback (most recent call last):
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 133, in get_conversation_state
    session = session_store.get_session()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\deps.py", line 247, in get_session
    self._session_state = SessionState.load(storage, self.session_id)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 54, in load
    turn_index=self.turn_index,
    ^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 32, in save
    def save(self, store: Storage) -> None:
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\conversation.py", line 148, in get_conversation_state
    raise HTTPException(status_code=500, detail=f"State error: {str(e)}")
fastapi.exceptions.HTTPException: 500: State error: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\responses.py", line 158, in __call__
    await send(
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 161, in _send
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 505, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:61836', 'GET', '/chat/conversation-state', '1.1', 500)
--- Logging error ---
Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 766, in app
    await self.default(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 652, in not_found
    raise HTTPException(status_code=404)
starlette.exceptions.HTTPException: 404: Not Found

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\responses.py", line 158, in __call__
    await send(
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 39, in sender
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 161, in _send
    await send(message)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 505, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:61869', 'GET', '/health', '1.1', 404)
--- Logging error ---
Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\chat.py", line 154, in route_intent
    state = _load_state(storage, session_id)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\chat.py", line 43, in _load_state
    return SessionState.load(storage, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 54, in load
    turn_index=self.turn_index,
    ^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 32, in save
    def save(self, store: Storage) -> None:
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 181, in __call__
    await response(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\responses.py", line 158, in __call__
    await send(
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 505, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:61882', 'POST', '/chat/route', '1.1', 500)
--- Logging error ---
Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\chat.py", line 154, in route_intent
    state = _load_state(storage, session_id)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\chat.py", line 43, in _load_state
    return SessionState.load(storage, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 54, in load
    turn_index=self.turn_index,
    ^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 32, in save
    def save(self, store: Storage) -> None:
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 440, in run_asgi
    self.logger.error(msg, exc_info=exc)
Message: 'Exception in ASGI application\n'
Arguments: ()
--- Logging error ---
Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\chat.py", line 154, in route_intent
    state = _load_state(storage, session_id)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\chat.py", line 43, in _load_state
    return SessionState.load(storage, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 54, in load
    turn_index=self.turn_index,
    ^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 32, in save
    def save(self, store: Storage) -> None:
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 181, in __call__
    await response(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\responses.py", line 158, in __call__
    await send(
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 505, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:61926', 'POST', '/chat/route', '1.1', 500)
--- Logging error ---
Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\fastapi\routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\starlette\concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\_backends\_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\anyio\_backends\_asyncio.py", line 807, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\chat.py", line 154, in route_intent
    state = _load_state(storage, session_id)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\routers\chat.py", line 43, in _load_state
    return SessionState.load(storage, session_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 54, in load
    turn_index=self.turn_index,
    ^^^^^^^^^^^^^^^^^
  File "E:\Downloads\Startagain\backend\app\services\session.py", line 32, in save
    def save(self, store: Storage) -> None:
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Storage.upsert_session() got an unexpected keyword argument 'pnm_scores'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ANACONDA\envs\comp0197_pt\Lib\logging\__init__.py", line 1113, in emit
    stream.write(msg + self.terminator)
ValueError: underlying buffer has been detached
Call stack:
  File "<string>", line 1, in <module>
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 641, in run_until_complete
    self.run_forever()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 608, in run_forever
    self._run_once()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\base_events.py", line 1936, in _run_once
    handle._run()
  File "D:\ANACONDA\envs\comp0197_pt\Lib\asyncio\events.py", line 84, in _run
    self._context.run(self._callback, *self._args)
